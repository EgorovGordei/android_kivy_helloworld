name: GitHub Actions Build
on: 
  push:
    branches: 
      [ builder ]
jobs:
  config:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: InstallCython        
        run: |
             sudo pip3 uninstall cython
             sudo apt-get remove cython
             sudo apt-get install cython

      - name: InstallKivy        
        run: |
             pip3 install kivy[base] kivy_examples
             
      - name: InstallBuildozer        
        run: |
             sudo apt-get install -y python3-setuptools
             pip3 install buildozer
             pip3 install https://github.com/kivy/buildozer/archive/master.zip
             git clone https://github.com/kivy/buildozer
             cd buildozer
             python3 setup.py build
             pip3 install -e .
             export PATH=~/.local/bin/:$PATH
             . ~/.bashrc
             cd ../../

      #- name: SomeMagic
      #  run: |
      #       sudo apt-get update
      #       sudo apt-get install build-essential
      #       sudo apt-get install libstdc++6
      #       sudo apt-get install aidl
      #- name: SomeMoreMagic
      #  run: |
      #       which aidl /usr/bin/aidl
      #       cp /usr/bin/aidl ~/.buildozer/android/platform/android-sdk/build-tools/31.0.0/
      #       sudo chmod 777 ~/.buildozer/android/platform/android-sdk/build-tools/31.0.0/aidl

      - name: Prepare        
        run: |
             buildozer init
             cat buildozer.spec

      - name: FirstRun
        continue-on-error: true
        run: |
             python3 buildozer_license.py
             #buildozer android debug deploy run
      - name: BetweenRuns
        run: |
             ls /home/runner
             ls /home/runneradmin
             ls /home/runner/.buildozer/android/platform/android-ndk-r19b/build-tools/29.0.2/lib64/
             ls /home/runner/.buildozer/android/platform/android-ndk-r19b/build-tools/29.0.2/
             buildozer android clean
      - name: SecondRun
        run: |
             buildozer android debug deploy run

      - name: UploadArtifacts
        uses: actions/upload-artifact@v2
        with:
          name: Distributive
          path: |
            task5/bin
